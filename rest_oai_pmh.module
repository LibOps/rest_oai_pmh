<?php

/**
 * @file
 * Contains rest_oai_pmh.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function rest_oai_pmh_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the rest_oai_pmh module.
    case 'help.page.rest_oai_pmh':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Exposes schema.org dublin core mappings in an OAI-PMH endpoint') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_rest_resource_alter().
 */
function rest_oai_pmh_rest_resource_alter(&$definitions) {
  // if the repository admin set a path, override the default URI
	$path = \Drupal::config('rest_oai_pmh.settings')->get('repository_path');
  if ($path) {
  	$definitions['oai_pmh']['uri_paths']['canonical'] = $path;
  }
}


/**
 * Implements hook_metatag_tags_alter().
 */
function rest_oai_pmh_metatag_tags_alter(&$definitions) {
  // set some dublin core metatags to allow for multiple values
  $terms = ['dcterms_creator', 'dcterms_subject'];
  foreach ($terms as $term) {
    $definitions[$term]['multiple'] = TRUE;
  }
}
